<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="robots" content="noindex, nofollow">
		<title>Gacha | fingger</title>
		<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
		<script src="./FinggerGacha.js"></script>
		<script>
			window.atlas = {
				src: "/assets/images/gacha/FinggerGacha_atlas_.png",
				id: "FinggerGacha_atlas_"
			};
			//*
			window.itemNames = [];
			window.itemImages = [];
			/*/
			window.itemNames = [
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
				'item_dummy',
			];
			window.itemImages = [
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
				'/assets/images/gacha/item_dummy.png',
			];
			//*/
			function setData(images, names) {
				window.itemNames = names;
				window.itemImages = images;
			}
			function getManifest() {
				var list = [];
				list.push(atlas);
				window.itemImages.forEach((src, i) => list.push({src: src, id: 'item_' + i}));
				return list;
			}
			function start() {
				if(!exportRoot) {
					console.log('createjs is not ready');
					return;
				}
				exportRoot.StartGacha({
					tips: window.itemNames,
				});
			}
		</script>
		<script>
			var canvas, stage, exportRoot, /*anim_container, dom_overlay_container,*/ fnStartAnimation;
			function init() {
				canvas = document.getElementById('canvas');
				//anim_container = document.getElementById('animation_container');
				//dom_overlay_container = document.getElementById('dom_overlay_container');
				var comp = AdobeAn.getComposition('1F84C6F134A1934282BA3FC0162A47B5');
				var lib = comp.getLibrary();
				lib.properties.manifest = getManifest();
				createjs.MotionGuidePlugin.install();
				var loader = new createjs.LoadQueue(false);
				loader.addEventListener('fileload', function (evt) { handleFileLoad(evt, comp); });
				loader.addEventListener('complete', function (evt) { handleComplete(evt, comp); });
				loader.loadManifest(lib.properties.manifest);
			}
			function handleFileLoad(evt, comp) {
				var images = comp.getImages();
				if (evt && (evt.item.type == 'image')) {
					images[evt.item.id] = evt.result;
				}
			}
			function handleComplete(evt, comp) {
				//This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
				var lib = comp.getLibrary();
				var ss = comp.getSpriteSheet();
				var queue = evt.target;
				var ssMetadata = lib.ssMetadata;
				for (i = 0; i < ssMetadata.length; i++) {
					ss[ssMetadata[i].name] = new createjs.SpriteSheet({
						images: [ queue.getResult(ssMetadata[i].name) ],
						frames: ssMetadata[i].frames,
					});
				}
				exportRoot = new lib.FinggerGacha();
				stage = new lib.Stage(canvas);
				stage.enableMouseOver();
				//Registers the "tick" event listener.
				fnStartAnimation = function () {
					stage.addChild(exportRoot);
					createjs.Ticker.setFPS(lib.properties.fps);
					createjs.Ticker.addEventListener('tick', stage);
				}
				// Code to support hidpi screens and responsive scaling.
				//AdobeAn.makeResponsive(false, 'both', false, 1, [canvas, anim_container]);
				AdobeAn.compositionLoaded(lib.properties.id);
				fnStartAnimation();
			}

			if(window.parent === window) {
				document.addEventListener('DOMContentLoaded', init);
			}
		</script>
		<style>
	        html, body {
	            margin: 0;
	            padding: 0;
		        overflow: hidden;
		        background-color: #333F53;
		        background-color:rgba(51, 63, 83, 0);
		        width: 100%;
		        height: 100%;
	        }
	        canvas {
		        position: relative;
		        display: block;
		        top: 0;
		        left: 0;
		        background-color:rgba(51, 63, 83, 1.00);
		        width: 640px;
		        height: 720px;
	        }
		</style>
	</head>
	<body>
		<canvas id="canvas" width="640" height="720"></canvas>
	</body>
</html>